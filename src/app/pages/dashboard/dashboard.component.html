<div class="dashboard-container fade-in">
    <!-- Header estilo Web Sobrio -->
    <!-- Header Moderno y Elegante -->
    <!-- Header Moderno y Elegante (CSS Class Based) -->
    <div class="system-web-header" *ngIf="stats">
        
        <!-- IZQUIERDA: Identidad Visual y Plataforma -->
        <div class="header-brand">
            <h1 class="page-title">
                <span class="brand-main">Sandra</span> <span class="brand-sub">Desktop</span>
            </h1>
            <div class="os-badge">
                <span class="os-icon-box">
                    <i [class]="getOsIcon(stats.os_info)"></i>
                </span>
                <span>{{ stats.os_info }}</span>
            </div>
        </div>

        <!-- DERECHA: Telemetría Interactiva (Píldoras) -->
        <div class="header-status">
            
            <!-- IP Pill -->
            <div class="metric-pill pill-network clickable" (click)="openInfoModal()" title="Ver detalles de Red">
                <i class="fas fa-network-wired"></i>
                <div class="pill-content">
                    <span class="pill-label">Red</span>
                    <span class="pill-value">{{ networkInfo[0] || '---' }}</span>
                </div>
            </div>

            <!-- Identity Pill -->
            <!-- <div class="metric-pill pill-identity clickable" (click)="openInfoModal()" title="Ver Identidad Hardware">
                <i class="fas fa-fingerprint"></i>
                <div class="pill-content">
                    <span class="pill-label">ID</span>
                    <span class="pill-value ellipsis">{{ stats.mac_address }}</span>
                </div>
            </div> -->

            <!-- Storage Pill -->
            <div class="metric-pill pill-storage" title="Almacenamiento Local">
                <i class="fas fa-hdd"></i>
                <div class="pill-content">
                    <span class="pill-label">Espacio</span>
                    <span class="pill-value">{{ formatBytes(stats.disk_free) }}</span>
                </div>
            </div>

            <!-- DB Pill -->
            <div class="metric-pill pill-db clickable" (click)="onDbClick.emit()" title="Core Database Status">
                <i class="fas fa-database"></i>
                <div class="pill-content">
                    <span class="pill-label">Core DB</span>
                    <span class="pill-value" *ngIf="dbStats">{{ formatBytes(dbStats.size_bytes) }}</span>
                </div>
            </div>

        </div>
    </div>
    
    <div class="apps-canvas">
        <div class="app-tile" *ngFor="let app of apps" (click)="!app.installed && onInstall.emit(app)">
            
            <!-- Main Content Layer -->
            <div class="tile-body">
                <div class="tile-icon">
                    <i [class]="app.icon"></i>
                </div>
                <div class="tile-info">
                    <span class="name">{{ app.name }} </span>
                    <span class="meta" *ngIf="app.installed">
                        <span class="status-dot active"></span> Instalado
                    </span>
                    <span class="meta" *ngIf="!app.installed">
                        <span class="status-dot"></span> Disponible
                    </span>
                </div>
                
                
            </div>

            <!-- Intelligent Overlay Layer (Slide Up) -->
            <div class="tile-overlay" *ngIf="app.installed">
                <button class="btn-smart" (click)="onOpen.emit(app); $event.stopPropagation()">
                    Abrir <i class="fas fa-arrow-right"></i>
                </button>
                
                <div class="btn-smart-secondary">
                    <div class="icon-smart" (click)="onUpdate.emit(app); $event.stopPropagation()" title="Buscar Actualizaciones">
                        <i class="fas fa-sync-alt"></i>
                    </div>
                    <div class="icon-smart delete" (click)="onDelete.emit(app); $event.stopPropagation()" title="Desactivar / Quitar">
                        <i class="fas fa-folder-minus"></i>
                    </div>
                </div>
            </div>

            <!-- Intelligent Overlay Layer (Slide Up) - AVAILABLE -->
            <div class="tile-overlay" *ngIf="!app.installed">
                 <button class="btn-smart " (click)="onInstall.emit(app); $event.stopPropagation()">
                    Descargar App <i class="fas fa-cloud-download-alt"></i>
                </button>
            </div>

        </div>
    </div>
</div>

<!-- Identity & Network Info Modal -->
<div class="modal-overlay" *ngIf="showInfoModal" (click)="closeModal()">
    <div class="modal-card info-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3 class="modal-title">Identidad del Sistema</h3>
           
        </div>
        
        <div class="modal-body">
            <!-- Hardware ID -->
            <div class="info-group">
                <label>ID de Hardware (MAC)</label>
                <div class="info-value copyable" title="Copiar">
                    <i class="fas fa-fingerprint icon-accent"></i>
                    <span>{{ stats?.mac_address || '---' }}</span>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Network Info -->
            <div class="info-group">
                <label>Direcciones IP Locales</label>
                <div class="ip-list">
                    <div class="info-value small" *ngFor="let ip of networkInfo">
                        <i class="fas fa-network-wired"></i> {{ ip }}
                    </div>
                    <div class="info-value small text-muted" *ngIf="networkInfo.length === 0">Sin conexión local detectada</div>
                </div>
            </div>

            <div class="divider"></div>

            <!-- Public IP -->
            <div class="info-group">
                <label>IP Pública</label>
                <div class="info-value highlight">
                    <i class="fas fa-globe-americas icon-accent"></i>
                    <span>{{ publicIp }}</span>
                </div>
            </div>
        </div>
        
        <div class="modal-actions">
            <button class="btn-modal-primary" (click)="closeModal()">Entendido</button>
        </div>
    </div>
</div>